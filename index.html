<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Rasca y Gana - Artem</title>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">

    <style>
        :root {
            --deep-purple: #1a0b2e;
            --gold: #FFD700;
            --magenta: #d946ef;
            --green: #2ecc71;
            --white: #ffffff;
        }

        body { 
            margin: 0; padding: 0; 
            background: radial-gradient(circle, #462c7a 0%, #1a0b2e 100%); 
            font-family: 'Segoe UI', sans-serif; color: var(--white); 
            min-height: 100vh; display: flex; flex-direction: column; align-items: center;
        }

        /* Logo Superior */
        .header-logo {
            width: 100%;
            height: 90px;
            display: flex; justify-content: center; align-items: center;
            padding: 10px 0;
            z-index: 10;
        }
        .header-logo img {
            max-width: 200px;
            max-height: 70px;
            object-fit: contain;
        }

        /* Selector de Tarjetas */
        #selector-tarjetas {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; flex-grow: 1; padding-bottom: 50px;
        }
        .contenedor-opciones {
            display: flex; gap: 12px; margin-top: 20px;
        }
        .tapa-preview {
            width: 90px; height: 180px; /* Proporci√≥n 400x800 */
            border: 3px solid var(--white); border-radius: 12px;
            cursor: pointer; transition: transform 0.2s;
            object-fit: cover;
        }
        .tapa-preview:active { transform: scale(0.95); }

        /* Contenedor del Juego */
        #contenedor-juego { 
            display: none; flex-direction: column; align-items: center; padding-bottom: 30px;
        }
        
        canvas { 
            border: 5px solid var(--white); border-radius: 20px; 
            background: #fff; touch-action: none; 
            width: 280px; height: 560px; /* Escalado visual del 400x800 */
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .btn-action {
            background: linear-gradient(135deg, var(--magenta), #8e54e9);
            color: white; border: none; padding: 16px 35px; border-radius: 30px;
            font-weight: 800; font-size: 16px; cursor: pointer; margin-top: 20px;
            text-transform: uppercase; box-shadow: 0 4px 15px rgba(217, 70, 239, 0.4);
        }

        /* Modales y Registro */
        .overlay { 
            display: none; position: fixed; inset: 0; background: rgba(26, 11, 46, 0.98); 
            z-index: 1000; flex-direction: column; justify-content: center; align-items: center; 
        }
        .caja-blanca { 
            background: white; color: #333; padding: 30px; border-radius: 25px; 
            width: 85%; max-width: 320px; text-align: center;
        }
        input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="header-logo">
        <img src="logo-cliente.webp" alt="Artem Logo">
    </div>

    <div id="selector-tarjetas">
        <h2 style="color: var(--gold); text-shadow: 0 2px 4px rgba(0,0,0,0.5);">¬°ELIGE TU TARJETA!</h2>
        <p>Toca una para empezar a rascar</p>
        <div class="contenedor-opciones">
            <img src="tapa1.webp" class="tapa-preview" onclick="iniciarRasca(1)">
            <img src="tapa2.webp" class="tapa-preview" onclick="iniciarRasca(2)">
            <img src="tapa3.webp" class="tapa-preview" onclick="iniciarRasca(3)">
        </div>
    </div>

    <div id="contenedor-juego">
        <p style="font-weight: bold; color: var(--gold); margin-bottom: 10px;">DESCUBRE TU PREMIO ABAJO üëá</p>
        <canvas id="lienzo-rascar" width="400" height="800"></canvas>
        <button id="btn-reclamar" class="btn-action" style="display:none; background: var(--green);" onclick="abrirRegistro()">RECLAMAR PREMIO</button>
    </div>

    <div id="modal-registro" class="overlay">
        <div class="caja-blanca">
            <h2 style="margin:0; color: #1a0b2e;">¬°FELICIDADES!</h2>
            <p id="txt-premio-ganado" style="font-weight: 900; color: #d35400; font-size: 1.3rem; margin: 15px 0;"></p>
            <input type="text" id="nombre" placeholder="Nombre completo">
            <input type="tel" id="whatsapp" placeholder="WhatsApp (10 d√≠gitos)">
            
            <div style="font-size: 12px; margin: 15px 0; display: flex; align-items: flex-start; gap: 8px; text-align: left;">
                <input type="checkbox" id="aviso"> 
                <label for="aviso">Acepto el <a href="javascript:void(0)" onclick="togglePriv(true)" style="color: var(--magenta);">aviso de privacidad</a>.</label>
            </div>
            
            <button class="btn-action" style="width:100%;" onclick="enviarReclamo()">CANJEAR PREMIO</button>
        </div>
    </div>

    <div id="modal-priv" class="overlay" style="z-index: 2000;">
        <div class="caja-blanca" style="text-align: left;">
            <h3 style="margin-top:0;">Aviso de Privacidad</h3>
            <p style="font-size: 14px; line-height: 1.4;">Los datos recabados por <b>Artem</b> (Nombre y WhatsApp) se utilizar√°n solo para la entrega del premio ganado en esta din√°mica. No se almacenan datos en servidores externos.</p>
            <button class="btn-action" style="width:100%;" onclick="togglePriv(false)">CERRAR</button>
        </div>
    </div>

    <script>
        // SEGURIDAD: Solo abre con ?acceso=valido
        const params = new URLSearchParams(window.location.search);
        if(params.get('acceso') !== 'valido') {
            document.body.innerHTML = "<div style='padding:50px; text-align:center;'><h2>‚ö†Ô∏è Acceso Restringido</h2><p>Escanea el c√≥digo QR en tienda para participar.</p></div>";
        }

        const premiosInfo = {
            1: "10% DE DESCUENTO ETIQUETA ROJA",
            2: "50% DE DESCUENTO ETIQUETA AMARILLA",
            3: "30% DE DESCUENTO TODA LA TIENDA"
        };

        let premioId = 0;
        const canvas = document.getElementById('lienzo-rascar');
        const ctx = canvas.getContext('2d');
        let rascadoListo = false;

        function iniciarRasca(idTapa) {
            premioId = Math.floor(Math.random() * 3) + 1; // Selecci√≥n al azar del premio
            document.getElementById('selector-tarjetas').style.display = 'none';
            document.getElementById('contenedor-juego').style.display = 'flex';

            // 1. Poner la imagen del premio al fondo del canvas
            canvas.style.backgroundImage = `url('premio${premioId}.webp')`;
            canvas.style.backgroundSize = "100% 100%";

            // 2. Dibujar la tapa seleccionada encima
            const imgTapa = new Image();
            imgTapa.src = `tapa${idTapa}.webp`;
            imgTapa.onload = () => {
                ctx.drawImage(imgTapa, 0, 0, 400, 800);
            };
        }

        function rascar(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            
            // Ajuste de coordenadas escala 400x800
            const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
            const y = (touch.clientY - rect.top) * (canvas.height / rect.height);

            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 35, 0, Math.PI * 2);
            ctx.fill();

            validarProgreso();
        }

        function validarProgreso() {
            if(rascadoListo) return;
            // Validamos un punto central (400x800 -> 200, 400)
            const data = ctx.getImageData(200, 400, 1, 1).data;
            if(data[3] === 0) {
                rascadoListo = true;
                document.getElementById('btn-reclamar').style.display = 'block';
            }
        }

        canvas.addEventListener('touchmove', rascar);
        canvas.addEventListener('mousemove', (e) => { if(e.buttons === 1) rascar(e); });

        function abrirRegistro() {
            document.getElementById('txt-premio-ganado').innerText = premiosInfo[premioId];
            document.getElementById('modal-registro').style.display = 'flex';
        }

        function togglePriv(val) {
            document.getElementById('modal-priv').style.display = val ? 'flex' : 'none';
        }

        function enviarReclamo() {
            const nom = document.getElementById('nombre').value;
            const tel = document.getElementById('whatsapp').value;
            const aviso = document.getElementById('aviso').checked;

            if(!nom || tel.length < 10 || !aviso) {
                alert("Por favor completa los datos y acepta la privacidad.");
                return;
            }

            const mensaje = encodeURIComponent(`*ARTEM - RASCA Y GANA*\n\nüèÜ PREMIO: ${premiosInfo[premioId]}\nüë§ CLIENTE: ${nom}\nüì± TEL: ${tel}\n\nCanje solicitado desde el sitio web.`);
            window.location.href = `https://wa.me/5215542492026?text=${mensaje}`;
        }
    </script>
</body>
</html>
